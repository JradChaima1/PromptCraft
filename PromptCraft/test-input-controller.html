<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InputController Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            font-family: monospace;
            color: #fff;
        }
        #game {
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border: 2px solid #00ff00;
            border-radius: 5px;
            font-size: 12px;
            line-height: 1.6;
            max-width: 400px;
        }
        #info h3 {
            margin: 0 0 10px 0;
            color: #00ff00;
        }
        #info ul {
            margin: 5px 0;
            padding-left: 20px;
        }
        #status {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border: 2px solid #0088ff;
            border-radius: 5px;
            font-size: 11px;
        }
        .key {
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            border: 1px solid #666;
        }
    </style>
</head>
<body>
    <div id="game"></div>
    
    <div id="info">
        <h3>üéÆ InputController Test</h3>
        <p><strong>Player Movement:</strong></p>
        <ul>
            <li><span class="key">Arrow Keys</span> or <span class="key">WASD</span> - Move</li>
            <li><span class="key">Space</span> - Jump</li>
        </ul>
        <p><strong>Camera Controls:</strong></p>
        <ul>
            <li><span class="key">Mouse Wheel</span> - Zoom (0.5x - 2.0x)</li>
            <li><span class="key">Middle Click + Drag</span> - Pan camera</li>
            <li><span class="key">Double Click Player</span> - Center camera</li>
        </ul>
        <p><strong>Asset Interaction:</strong></p>
        <ul>
            <li><span class="key">Left Click</span> - Select/Drag assets</li>
            <li><span class="key">Delete</span> - Remove selected</li>
        </ul>
        <p><strong>Shortcuts:</strong></p>
        <ul>
            <li><span class="key">G</span> - Generator (simulated)</li>
            <li><span class="key">L</span> - Library (simulated)</li>
            <li><span class="key">ESC</span> - Deselect</li>
            <li><span class="key">Ctrl+S</span> - Save (console)</li>
        </ul>
    </div>
    
    <div id="status">
        <div>Camera Zoom: <span id="zoom">1.0</span>x</div>
        <div>Camera Pos: (<span id="camX">0</span>, <span id="camY">0</span>)</div>
        <div>Player Pos: (<span id="playerX">0</span>, <span id="playerY">0</span>)</div>
        <div>Selected: <span id="selected">None</span></div>
    </div>

    <script type="module">
        import Phaser from './node_modules/phaser/dist/phaser.esm.js';
        import InputController from './src/controllers/InputController.js';

        // Mock managers for testing
        class MockWorldManager {
            constructor() {
                this.selectedAsset = null;
                this.assets = [];
            }
            
            getAllPlacedAssets() {
                return this.assets;
            }
            
            selectAsset(id) {
                this.selectedAsset = this.assets.find(a => a.instanceId === id);
                console.log('Selected asset:', id);
                document.getElementById('selected').textContent = id;
            }
            
            deselectAsset() {
                this.selectedAsset = null;
                console.log('Deselected asset');
                document.getElementById('selected').textContent = 'None';
            }
            
            getSelectedAsset() {
                return this.selectedAsset;
            }
            
            moveAsset(id, x, y) {
                const asset = this.assets.find(a => a.instanceId === id);
                if (asset && asset.sprite) {
                    asset.sprite.setPosition(x, y);
                }
            }
            
            removePlacedAsset(id) {
                const index = this.assets.findIndex(a => a.instanceId === id);
                if (index !== -1) {
                    const asset = this.assets[index];
                    if (asset.sprite) {
                        asset.sprite.destroy();
                    }
                    this.assets.splice(index, 1);
                    console.log('Removed asset:', id);
                    this.deselectAsset();
                }
            }
            
            saveWorld() {
                console.log('World saved!');
            }
            
            exportWorld() {
                console.log('World exported!');
            }
        }

        class MockUIManager {
            showGenerationModal() {
                console.log('üìù Generation modal opened');
                alert('Generation Modal (G key pressed)');
            }
            
            showLibraryModal() {
                console.log('üìö Library modal opened');
                alert('Library Modal (L key pressed)');
            }
            
            hideAllModals() {
                console.log('‚ùå All modals closed');
            }
            
            showErrorModal(message) {
                console.error('Error:', message);
                alert('Error: ' + message);
            }
        }

        class TestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'TestScene' });
            }

            preload() {
                // Create simple colored rectangles for testing
                const graphics = this.add.graphics();
                
                // Player texture (blue)
                graphics.fillStyle(0x0088ff, 1);
                graphics.fillRect(0, 0, 32, 32);
                graphics.generateTexture('player', 32, 32);
                
                // Ground texture (green)
                graphics.clear();
                graphics.fillStyle(0x00aa00, 1);
                graphics.fillRect(0, 0, 64, 64);
                graphics.generateTexture('ground', 64, 64);
                
                // Asset texture (red)
                graphics.clear();
                graphics.fillStyle(0xff0000, 1);
                graphics.fillRect(0, 0, 48, 48);
                graphics.generateTexture('asset', 48, 48);
                
                graphics.destroy();
            }

            create() {
                const WORLD_WIDTH = 4000;
                const WORLD_HEIGHT = 600;

                // Set world bounds
                this.physics.world.setBounds(0, 0, WORLD_WIDTH, WORLD_HEIGHT);

                // Create ground
                this.ground = this.physics.add.staticGroup();
                for (let x = 0; x < WORLD_WIDTH; x += 64) {
                    const tile = this.ground.create(x, WORLD_HEIGHT - 32, 'ground');
                    tile.refreshBody();
                }

                // Create player
                this.player = this.physics.add.sprite(400, 300, 'player');
                this.player.setCollideWorldBounds(true);
                this.player.playerDirection = 'right';
                
                // Simple animations (just for testing)
                this.player.anims = {
                    play: (anim) => {
                        // Mock animation
                    }
                };

                // Collision
                this.physics.add.collider(this.player, this.ground);

                // Camera setup
                this.cameras.main.setBounds(0, 0, WORLD_WIDTH, WORLD_HEIGHT);

                // Create mock managers
                this.worldManager = new MockWorldManager();
                this.uiManager = new MockUIManager();

                // Create some test assets to interact with
                for (let i = 0; i < 5; i++) {
                    const x = 600 + i * 150;
                    const y = 400;
                    const sprite = this.physics.add.sprite(x, y, 'asset');
                    sprite.setInteractive();
                    
                    const asset = {
                        instanceId: `asset-${i}`,
                        sprite: sprite
                    };
                    this.worldManager.assets.push(asset);
                }

                // Create InputController
                this.inputController = new InputController(this);
                this.inputController.setReferences(
                    this.player,
                    this.worldManager,
                    this.uiManager,
                    null
                );

                // Enable camera following
                this.inputController.enableCameraFollow();

                // Update status display
                this.updateStatus();
            }

            update() {
                // Update input controller
                this.inputController.update();
                
                // Update status display
                this.updateStatus();
            }

            updateStatus() {
                const cam = this.cameras.main;
                document.getElementById('zoom').textContent = cam.zoom.toFixed(2);
                document.getElementById('camX').textContent = Math.round(cam.scrollX);
                document.getElementById('camY').textContent = Math.round(cam.scrollY);
                document.getElementById('playerX').textContent = Math.round(this.player.x);
                document.getElementById('playerY').textContent = Math.round(this.player.y);
            }
        }

        // Phaser game configuration
        const config = {
            type: Phaser.AUTO,
            parent: 'game',
            width: window.innerWidth,
            height: window.innerHeight,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 800 },
                    debug: false
                }
            },
            scene: [TestScene]
        };

        const game = new Phaser.Game(config);

        // Handle window resize
        window.addEventListener('resize', () => {
            game.scale.resize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
